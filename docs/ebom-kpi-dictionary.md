# EBOM 实时全景驾驶舱 · 指标库与阈值字典（TASK-001）

状态：完成（草案） · 2025-09-28
负责人建议：系统工程负责人（指标口径）、数据工程负责人（采样与聚合）、配置管理员（版本健康）

## 1. 指标分层
- 总体健康（Health）：R/Y/G 灯 + 说明
- 版本与基线（Baseline）：变更频次、审批完成率、未闭环事项、成熟度评分
- 设计性能（Design KPIs）：按系统/零件的关键参数达成度/裕度
- 验证进度（V&V）：仿真覆盖、试验覆盖、阻塞项
- 风险治理（Risk）：风险关闭率、超期风险数

## 2. 指标清单（示例）
| ID | 名称 | 定义 | 单位 | 采样 | 阈值规则 | 备注 |
|---|---|---|---|---|---|---|
| HLT-001 | 研制健康度 | 加权汇总（研发完成度、仿真完成度、试验完成度、风险关闭率） | 分 | 1h | <60 红, 60-80 黄, ≥80 绿 | FE-only 原型按最新值加权计算，落地后由 BFF 返回 |
| DEV-CPL-001 | 研发完成度 | 已完成研发里程碑 / 计划里程碑 | % | 1h | <70 红, 70-90 黄, ≥90 绿 | 来源 研发项目系统（研制计划） |
| SIM-COV-001 | 仿真覆盖率 | 已验证仿真算例 / 应验证算例 | % | 4h | <60 红, 60-85 黄, ≥85 绿 | 来源 仿真 BOM / CAE 平台 |
| TST-COV-001 | 试验覆盖率 | 已完成试验 / 计划试验 | % | 4h | <60 红, 60-80 黄, ≥80 绿 | 来源 试验管理系统 |
| RSK-CLS-001 | 风险关闭率 | 已关闭风险 / 总风险 | % | 1h | <70 红, 70-90 黄, ≥90 绿 | 来源 风险闭环系统 |
| RSK-OVD-001 | 风险超期数 | 逾期未关闭的风险 | 个 | 1h | >5 红, 1-5 黄, 0 绿 | 可与 RSK-CLS-001 联动显示 |
| BL-CHG-001 | 近7天变更数 | 近7天变更单计数 | 个 | 1h | >40 红, 20-40 黄, <20 绿 | 来源 PLM；低值更优 |
| BL-APR-001 | 审批完成率 | 已审批 / 总审批 | % | 1h | <70 红, 70-90 黄, ≥90 绿 | 来源 PLM |
| BL-OPN-001 | 未闭环事项 | 未关闭问题 / 动作 | 个 | 1h | >30 红, 10-30 黄, <10 绿 | 来源 闭环系统 |
| KPI-DES-THR | 关键性能超限 | 超出设计阈值的项数 | 个 | 1h | >0 黄 | 来源 仿真/试验；配合三维高亮 |

### 2.1 健康度权重（建议）
- 研发完成度 25%
- 仿真完成度 25%
- 试验完成度 25%
- 风险关闭率 25%

> 权重可按角色在 `docs/kpi-threshold-config.json` 的 `presets` 中调整。

## 3. 健康度评分落地（FE-only 原型）
- 评分来源：`docs/kpi-threshold-config.json` 中的 `healthFactors` 映射，当前为 `{ dev → DEV-CPL-001, sim → SIM-COV-001, test → TST-COV-001, risk → RSK-CLS-001 }`。
- 计算方式：
  1. 获取每个因子的最新值（假设取值 0–100，对应百分比）；
  2. 根据当前预设的权重 `w_i`（默认 0.25）计算 `score = Σ w_i × value_i`；
  3. 若某因子缺失，则按剩余权重归一化；
  4. 结果写回虚拟 KPI `HLT-001` 以驱动驾驶舱健康灯与 KPI 卡，并保留原始 `freshnessSec`/`trust`；
  5. “公式”按钮 tooltip 会同步展示当前权重与各因子数值，便于评审解释。
- 说明：待后端接入后，可直接返回计算好的 `HLT-001`，前端按上述逻辑作为兜底。

## 4. 阈值参数化与预设
- 配置文件：`docs/kpi-threshold-config.json`
  - `presets`: 预设名 → 展示名与健康度权重
  - `healthFactors`: 权重键 → KPI ID + 展示名
  - `thresholds`: KPI ID → 各预设的 `{ low, high, rule }`
- 前端加载顺序：预设阈值 → 本地覆盖（`kpiThresholdOverrides:{preset}`）→ 应用到 KPI。
- 预设选择：在驾驶舱工具条可切换（持久化 `kpiThresholdPreset`）。

## 5. 数据新鲜度（freshnessSec）与可信级别（trust）
- FreshnessSec：Health 3600、Baseline 3600、V&V 14400、Design KPIs 3600
- Trust：
  - high：直连权威系统 + ≤24h
  - mid：ETL 日间批 + 24–72h
  - low：手工导入或>72h

## 6. 接口草案
- GET `/api/cockpit/kpis?nodeId=...` → `{ kpis: CockpitKpi[] }`
- GET `/api/cockpit/baseline-health?nodeId=...` → `BaselineHealth`

## 7. 开放问题
- 变更数与审批率是否以“设计中心”口径为准？
- 试验覆盖率分母如何定义：计划全集 vs 当前阶段？
- 风险关闭率是否需要按质量/安全两类设不同权重？
