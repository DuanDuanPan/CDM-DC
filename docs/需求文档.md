
# 产品需求文档（PRD）：产品过程数据中心（v2）

> 面向：产品/架构/研发/测试/实施团队  
> 宗旨：在保持 MVP 聚焦的同时，补齐 Phase 2/3 的关键需求与验收标准，并解决三份文档之间的范围/术语不一致。

---
## 1. 目标与背景（保持）
- 效率：将故障分析数据准备从**数周**缩至**数小时**；
- 资产：管理≥80% 过程数据，形成**100% 可追溯**；
- 闭环：赋能仿真—试验闭环与数字孪生。

---
## 2. 术语与范围一致性（新增）
- **项目空间**：权限与隔离单元（UI 中统一称“项目空间”）；
- **XBOM**：多视图结构（设计/工艺/试验件等）；
- **对比中心**：多方案/多工况/跨领域对比统一入口；
- **上下文图谱**：需求—设计—仿真—试验链路的可视化视图；
- **成套性**：某任务/方案所需交付物集合的完整性状态。

---
## 3. 功能性需求（FR）— 汇总与扩展
> 标记：**MVP**、**P2**（Phase 2）、**P3**（Phase 3）

**FR1（MVP） 数据汇集（手动）**：Web 上传并录入元数据/关键参数。  
**FR2（MVP） 分面导航**：项目/结构/领域/类型等分面组合筛选，计数提示。  
**FR3（MVP） 上下文展示（基础）**：资产详情展示元数据与上下文摘要。  
**FR4（MVP） 参数级数据模型**：关键技术参数可检索/比对。  
**FR5（P2） 全链路追溯**：跨需求—设计—仿真—试验可视化（见 FR28 图谱）。  
**FR6（P2） 多版本管理**：版本历史、差异比较、回退。  
**FR7（P2） XBOM 多视图**：DBOM/PBOM/试验件 BOM 切换与差异提示。  
**FR8（P2） 关系与配套性查看**：图谱/列表两种方式。  
**FR9（P2） 数据成套性管理**：定义清单、完整性校验、缺口提示。  
**FR10（P2） 专业 PLM 操作**：检入/检出、修订、发布（与 TC 同步）。  
**FR11（P2） 基线管理**：评审冻结、基线对比、基线报告导出。  
**FR12（MVP） 全文检索**：通用文档内容检索；结果高亮。  
**FR13（MVP） 服务端 API**：资产与元数据 CRUD、检索、查询。  
**FR14（P2） 受控分享**：跨项目授权、有效期/水印/只读链接。  
**FR15（MVP） 回收站**：可恢复/二次确认永久删除。  
**FR16（P2） 团队协同**：评论、@提及、通知、变更订阅。  
**FR17（MVP） 批量处理**：批量导入/导出/元数据编辑。  
**FR18（MVP） 通用预览**：PDF/图片/视频/文本。  
**FR19（MVP） 数据下载**：权限范围内可下载。  
**FR20（MVP） 访问控制**：项目空间级别 RBAC；最小权限。  
**FR21（MVP） 结构化组织**：项目空间 + 文件夹树（与分面并行）。

**FR22（P2） 对比中心**：  
- 支持**多方案/多工况/跨领域**对比；  
- 曲线对齐（时间零点/事件）、归一化、平滑；  
- 3D 半透叠加/闪烁对照；  
- 文本/参数差异表；  
- 对比结果可导出。

**FR23（P3） 自动采集代理**：  
- 本地采集器（监控路径/规则归集/元数据模板）；  
- 服务器侧采集（仿真/试验平台回传）；  
- 断点续传与离线缓存。

**FR24（P2） 高级预览（领域）**：3D/CAD 预览、CAE 云图、试验曲线交互。  
**FR25（P2） 参数分析**：趋势/分布/散点与回归；版本与方案维度切片。  
**FR26（P2） 审计与留痕**：全操作日志、下载/分享审计、可追责。  
**FR27（P2） 成套性交付**：一键打包导出（含元数据/签名）。  
**FR28（P2） 上下文关系图谱**：节点（需求/设计/仿真/试验/BOM）与边；断链识别。  
**FR29（P2） XBOM 差异模式**：跨视图增删差异高亮、快速定位映射。  
**FR30（P3） 数据治理**：主数据绑定/词汇表/质量规则（缺参、异常值、重复）。  
**FR31（P3） 指标与报表**：采纳率、入库率、闭环率、评审基线健康度。

---
## 4. 非功能需求（NFR）— 扩展
- **性能**：百万级对象分面筛选 <1s；大文件上传 10GB+；对比视图渲染 3–4 个大型对象保持流畅（>30 FPS 交互）。  
- **安全**：零信任、最小权限、全链路加密、行/列级审计、可水印分享。  
- **可靠性**：对象存储多副本；任务可重试；日志可追溯 36 个月。  
- **可用性**：WCAG 2.1 AA；键盘可达；高对比度模式。  
- **可维护性**：日志结构化、指标可观测（OpenTelemetry）；灰度与回滚。

---
## 5. 设计约束与集成假设（更新）
- 与 Teamcenter 双向集成（接口/导入导出/适配层兜底）；  
- 与仿真平台（结果与参数）、试验台架（时序/元数据）打通；  
- 采用 Monorepo/TypeScript；ES 支撑检索。

---
## 6. 用户故事与验收标准（节选，新增）
**US-22 对比中心（工程师）**  
- *Given* 我在数据探索器中多选对象，*When* 点击“加入对比”，*Then* 进入对比中心，默认按对象类型自动选择合理视图（曲线/3D/文档/参数表）。  
- **验收**：可切换对齐基准；可导出差异摘要；≥3 对象时仍能流畅操作。

**US-28 上下文关系图谱（专家/管理者）**  
- *Given* 我在资产详情页，*When* 点击“关系图谱”，*Then* 展示以当前资产为中心的一层关联，可按需展开上/下游。  
- **验收**：支持节点搜索与悬停卡片；断链节点高亮；可筛选节点类型。

**US-29 XBOM 差异模式（工艺/试制）**  
- *Given* 我在 DBOM 选中一个部件，*When* 切到 PBOM/试验件 BOM，*Then* 自动定位对应节点并高亮增删差异。  
- **验收**：无法映射时给出原因提示与替代定位。

…（其余 US/AC 详见附录 A 表）

---
## 7. 追溯矩阵（新增，摘录）
| PRD 功能 | UI/UX 章节 | 接口/数据 | 测试要点 |
|---|---|---|---|
| FR22 对比中心 | §7.6 | /api/compare | 多对象/多类型/性能 |
| FR28 关系图谱 | §7.7 | /api/graph | 断链识别/布局性能 |
| FR29 XBOM 差异 | §7.5 | /api/xbom | 映射规则/高亮正确性 |

---
## 8. 风险与开放问题（更新）
- CAE/3D 预览组件的适配范围与版权；  
- 试验台架数据标准化与去标识化；  
- TC/过程平台接口变更的影响。

---
## 9. 附录（新增）
- **附录 A**：完整用户故事与验收标准清单；  
- **附录 B**：数据模型草图与元数据字段表；  
- **附录 C**：接口清单（REST/事件）。

---
## 10. 分类调整方案（六大数据域）
为贴合“产品定义、设计实现、仿真验证、试验与测量、工艺与生产、管理与保障”六类数据视图，提出如下调整方案（不改变数据本源，只优化信息架构与导航）。

### 10.1 六类数据域定义与边界
- 产品定义（Definition）：需求/ICD/参数基线/XBOM 映射/方案说明与基线策略；追溯起点与语义约束。  
- 设计实现（Design Realization）：设计视图（结构/控制/性能预算/功率平衡等）与设计交付物；偏工程设计态。  
- 仿真验证（Simulation Verification）：仿真项目/实例/文件/对比；模型有效性与边界条件管理。  
- 试验与测量（Test & Measurement）：试验计划/覆盖/数据包/闭环状态；计量/标定数据（可纳入）。  
- 工艺与生产（Process & Production）：工艺路线/特殊工艺/制造就绪度/产线能力/排产与物料交付。  
- 管理与保障（Management & Support）：配置与质量（变更/基线/质量门/不合格）、协同与通知、权限审计与报表。

### 10.2 现有模块 → 六类映射
- 产品定义：
  - 需求详情与角色视角（RequirementDetailPanel）
  - 概览 Tab 的基线/指标/风险速览（概览保留为“跨域总览”，但归属 Definition 作为入口）
  - 输出项中的方案文档/ICD/XBOM/基线策略等
- 设计实现：
  - 结构/强度（StructuralOverview）
  - 控制与电子（ControlOverview）
  - 性能预算与功率平衡（PerformanceOverview 的预算/假设片段）
- 仿真验证：
  - 仿真树/内容/预览/对比（Simulation* 组件）
  - 概览中的仿真相关指标（可作为链接进入此域）
- 试验与测量：
  - 试验与验证看板（VerificationOverview：覆盖/任务/数据包/阻塞）
- 工艺与生产：
  - 制造与供应（ManufacturingOverview：就绪度/特殊工艺/交付/约束/产线能力/供应风险）
- 管理与保障：
  - 配置与质量（ConfigurationQualityOverview：基线/变更/质量门/不合格）
  - 协同与通知（CollaborationHub：在线/动态/提醒/评审）

### 10.3 UI/导航调整建议
- 保留“概览”作为 BOM 节点的跨域总览（带阶段切换：初样/试样/正样等）。
- 在概览旁新增“六域 Tab”（Definition/Design/Simulation/Test/Process/Management），或以二级标签呈现。  
- 进入某域后，仅呈现该域组件与数据，避免跨域内容重复，概览仅做“速览+跳转”。
- 本地持久化：将 `activeDomain` 与 `activePhase` 写入 localStorage，延续当前视图偏好的实现。

### 10.4 数据模型与元数据调整
- 在现有数据结构（InputData/OutputData/Simulation/Verification等）新增字段：
  - `domain: 'definition' | 'design' | 'simulation' | 'test' | 'process' | 'management'`（用于域内筛选与聚合）；
  - `phase: 'concept' | 'preliminary' | 'detailed' | 'production' | ...`（阶段切片，概览使用）。
- 输出项（OutputData）建议补充：`ownerRole`、`sourceSystem`、`traceTo`（需求或设计项 ID），便于 Definition/Design 间追溯。

### 10.5 渐进式重构步骤（低风险）
1) 增加 `activeDomain` 状态与本地存储，不移除现有 Tab；先在 UI 增加“六域切换”并仅切换可见组件。
2) 给现有 mock 数据批量打上 `domain` 标记（可先在容器层做映射，逐步下沉到数据结构）。
3) 将“方案数据”已更名的“概览”稳定后，逐步把专业板块从概览迁移到对应域，仅保留指标速览与跳转。
4) 为“试验与测量”补充计量/标定样例，为“管理与保障”补充 RBAC/审计占位与报表占位。
5) 完成后整理文档与术语表，统一对外宣传口径（六域+概览）。

### 10.6 结论与约束（已确认）
1) 试验与测量：不纳入计量/标定与设备健康数据，暂不做台架双向同步。
2) 管理与保障：不包含交付后运维/服务数据（服务历史/备件/维修），聚焦配置/质量/协同/审计。
3) 设计实现：需要 CAD/3D 预览与 PDM 明细的集成（与 PLM 透传字段需在接口清单落地）。
4) 阶段：可自定义（概念/初样/试样/正样/量产等按型号/批次扩展）。
5) 导航：只保留“概览 + 六域”一套导航，不再并行旧生命周期大 Tab。

据此，下一步在 1–2 PR 内完成：
- UI：新增六域 Tab，并将专业面板迁移到各域；概览保留指标与阶段切换；移除旧生命周期 Tab。
- 数据：为现有 mock 数据补充 domain/phase 字段；为设计实现域引入 CAD/3D/PDM 占位。
